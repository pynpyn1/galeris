version: "3.8"

services:
    # 1. LAYANAN DATABASE (MySQL) - DIPERTAHANKAN
    mysql:
        image: mysql:8.0
        container_name: weddinglaravel # Nama container dipertahankan
        restart: always
        environment:
            MYSQL_ROOT_PASSWORD: dasa
        ports:
            - "3306:3306"
        volumes:
            - dbdata:/var/lib/mysql

    # 2. LAYANAN PHP-FPM (Interpreter PHP)
    dasa:
        image: php:8.2-fpm # Menggunakan image PHP-FPM
        container_name: dasa_php
        volumes:
            - .:/var/www/html # Mount folder proyek lokal
        depends_on:
            - mysql

    # 3. LAYANAN WEB SERVER (Nginx)
    webserver:
        image: nginx:latest
        container_name: dasa_nginx
        # Mengubah port ke 8088 untuk menghindari bentrok
        ports:
            - "8088:80"
        volumes:
            - .:/var/www/html
            # File konfigurasi Nginx harus diletakkan di ./nginx/default.conf
            - ./nginx/default.conf:/etc/nginx/conf.d/default.conf
        depends_on:
            - dasa # Webserver membutuhkan PHP-FPM

    # 4. LAYANAN ADMINISTRASI (phpMyAdmin)
    phpmyadmin:
        image: phpmyadmin/phpmyadmin:latest
        container_name: dasa_phpmyadmin
        restart: always
        ports:
            - 8080:80 # Akses phpMyAdmin di http://localhost:8080
        environment:
            PMA_HOST: mysql # Mengacu pada nama service database
            MYSQL_ROOT_PASSWORD: dasa
        depends_on:
            - mysql

volumes:
    dbdata:
